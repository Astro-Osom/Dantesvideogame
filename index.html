<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dante Saves Coco</title>
    <link rel="apple-touch-icon" href="Coco_32_Bit_Hero.png">
    <style>
        body {
            background-color: #111;
            color: white;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding-top: 10px;
            touch-action: none;
        }
        canvas {
            background-color: #87CEEB; 
            border: 4px solid #fff;
            max-width: 100%;
            height: auto;
            image-rendering: pixelated;
        }
        .controls-container {
            display: flex;
            justify-content: space-between;
            width: 90%;
            max-width: 800px;
            margin-top: 15px;
            user-select: none;
        }
        .d-pad, .action-pad {
            display: flex;
            gap: 10px;
        }
        .t-btn {
            background-color: #556B2F; 
            border: 3px solid #fff;
            color: white;
            font-size: 24px;
            font-weight: bold;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            user-select: none;
            touch-action: manipulation;
        }
        .t-btn:active { background-color: #8FBC8F; }
        
        #winScreen {
            display: none;
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            border: 4px solid #FF69B4;
            padding: 30px;
            text-align: center;
            border-radius: 15px;
            box-shadow: 0 0 30px #FF69B4;
        }
        #winScreen h1 { margin: 0; color: #FFB6C1; font-size: 40px; }
        #winScreen p { color: white; font-size: 20px; }
        
        /* Health Bar UI */
        #bossHealth {
            display: none;
            position: absolute;
            top: 20px;
            right: 50px;
            color: #FF1493;
            font-size: 24px;
            font-weight: bold;
            background: rgba(255,255,255,0.7);
            padding: 5px 15px;
            border-radius: 5px;
        }
    </style>
</head>
<body>

    <h2 style="margin: 5px;">DANTE SAVES COCO</h2>
    
    <div style="position: relative;">
        <canvas id="gameCanvas" width="800" height="400"></canvas>
        <div id="bossHealth">BOSS HP: 3</div>
        <div id="winScreen">
            <h1>YOU WIN!</h1>
            <p>Coco is safe... for now.</p>
            <p style="font-size: 14px; color: #aaa;">The journey continues... 2026</p>
        </div>
    </div>
    
    <div class="controls-container">
        <div class="d-pad">
            <button class="t-btn" id="btn-left">◀</button>
            <button class="t-btn" id="btn-right">▶</button>
        </div>
        <div class="action-pad">
            <button class="t-btn" id="btn-action">Pluck/Throw</button>
            <button class="t-btn" id="btn-jump">JUMP</button>
        </div>
    </div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const winScreen = document.getElementById("winScreen");
    const bossHealthUI = document.getElementById("bossHealth");

    // --- EXACT UNIFORM FILENAMES ---
    const danteImg = new Image(); danteImg.src = "Dante_32_Bit_Hero.png";
    const cocoImg = new Image(); cocoImg.src = "Coco_32_Bit_Hero.png";
    
    // NOTE: Boss will be a pink block until you add a kitty.png later!
    const kittyImg = new Image(); kittyImg.src = "kitty.png"; 

    let gameState = "PLAYING";
    let cameraX = 0;
    let frameCount = 0;

    const player = {
        x: 100, y: 200, width: 60, height: 100, // Scaled up slightly for the photo proportions
        dx: 0, dy: 0, speed: 6, jumpPower: -13,
        grounded: false, carrying: false, direction: 1
    };

    // The Boss: The Great Kitty
    const boss = { 
        x: 1300, y: 150, width: 120, height: 200, 
        hp: 3, alive: true, active: false 
    };
    
    const coco = { x: 1550, y: 250, width: 50, height: 80 }; // Adjusted for the photo proportions

    const platforms = [
        { x: -100, y: 350, w: 2000, h: 100, color: "#FFB6C1", stroke: "#FF69B4" }, 
        { x: 500, y: 250, w: 150, h: 20, color: "#FFB6C1", stroke: "#FF69B4" }
    ];

    let items = []; // Things Dante can pluck (like falling yarn balls)
    let projectiles = []; // Things Dante throws
    
    const gravity = 0.6;
    const friction = 0.8;
    const keys = { right: false, left: false, up: false, action: false };

    const bindTouch = (id, key, isAction = false) => {
        const btn = document.getElementById(id);
        btn.addEventListener("touchstart", (e) => { e.preventDefault(); keys[key] = true; });
        btn.addEventListener("touchend", (e) => { e.preventDefault(); keys[key] = false; if (isAction) handleAction(); });
    };
    bindTouch("btn-left", "left"); bindTouch("btn-right", "right");
    bindTouch("btn-jump", "up"); bindTouch("btn-action", "action", true);

    document.addEventListener("keydown", (e) => {
        if (e.code === "ArrowRight") keys.right = true;
        if (e.code === "ArrowLeft") keys.left = true;
        if (e.code === "Space" || e.code === "ArrowUp") keys.up = true;
    });
    document.addEventListener("keyup", (e) => {
        if (e.code === "ArrowRight") keys.right = false;
        if (e.code === "ArrowLeft") keys.left = false;
        if (e.code === "Space" || e.code === "ArrowUp") keys.up = false;
        if (e.code === "KeyX" || e.code === "ArrowDown") handleAction();
    });

    function handleAction() {
        if (gameState !== "PLAYING") return;
        if (player.carrying) {
            // Throw
            projectiles.push({
                x: player.x, y: player.y + 20, w: 25, h: 25, dx: player.direction * 14, dy: -3
            });
            player.carrying = false;
        } else if (player.grounded) {
            // Pluck item from ground
            for (let i = 0; i < items.length; i++) {
                if (items[i].grounded && Math.abs(player.x - items[i].x) < 50) {
                    items.splice(i, 1); 
                    player.carrying = true;
                    break;
                }
            }
        }
    }

    function drawCloud(x, y) {
        ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
        ctx.beginPath();
        ctx.arc(x, y, 20, Math.PI * 0.5, Math.PI * 1.5);
        ctx.arc(x + 20, y - 15, 30, Math.PI * 1, Math.PI * 1.8);
        ctx.arc(x + 50, y - 10, 25, Math.PI * 1.2, Math.PI * 2);
        ctx.arc(x + 70, y, 20, Math.PI * 1.5, Math.PI * 0.5);
        ctx.fill();
    }

    function update() {
        if (gameState !== "PLAYING") return;
        frameCount++;

        if (keys.right) { player.dx = player.speed; player.direction = 1; }
        else if (keys.left) { player.dx = -player.speed; player.direction = -1; }
        else player.dx *= friction;

        if (keys.up && player.grounded) { player.dy = player.jumpPower; player.grounded = false; }

        player.dy += gravity;
        player.x += player.dx;
        player.y += player.dy;

        // Boss Arena Camera Lock
        if (player.x > 900) {
            boss.active = true;
            cameraX = 900; // Lock camera on the boss fight
            bossHealthUI.style.display = boss.alive ? "block" : "none";
            if (player.x < 900) player.x = 900; 
        } else {
            cameraX = player.x - 300;
            if (cameraX < 0) cameraX = 0;
        }

        if (boss.alive && player.x + player.width > boss.x) {
            player.x = boss.x - player.width;
            player.dx = 0;
        }

        player.grounded = false;
        platforms.forEach(p => {
            if (player.x < p.x + p.w && player.x + player.width > p.x &&
                player.y + player.height > p.y && player.y + player.height < p.y + player.dy + 2) {
                player.grounded = true; player.dy = 0; player.y = p.y - player.height;
            }
        });

        // Boss AI: Drop Yarn Balls
        if (boss.active && boss.alive && frameCount % 90 === 0) {
            items.push({
                x: boss.x - 50 - Math.random() * 300, y: -50, w: 25, h: 25, dy: 0, grounded: false
            });
        }

        // Update Items (Yarn Balls falling)
        items.forEach(i => {
            if (!i.grounded) {
                i.dy += gravity; i.y += i.dy;
                if (i.y >= 325) { i.y = 325; i.dy = 0; i.grounded = true; }
            }
        });

        // Projectiles & Hit Detection
        projectiles.forEach((p, index) => {
            p.dy += gravity; p.x += p.dx; p.y += p.dy;
            
            if (boss.alive && p.x + p.w > boss.x && p.x < boss.x + boss.width && p.y > boss.y && p.y < boss.y + boss.height) {
                boss.hp--;
                bossHealthUI.innerText = "BOSS HP: " + boss.hp;
                projectiles.splice(index, 1);
                
                if (boss.hp <= 0) {
                    boss.alive = false;
                    bossHealthUI.style.display = "none";
                }
            }
            if (p.y > canvas.height) projectiles.splice(index, 1);
        });

        // Win Condition
        if (!boss.alive && Math.abs(player.x - coco.x) < 50) {
            gameState = "WIN";
            winScreen.style.display = "block";
        }

        draw();
        requestAnimationFrame(update);
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.save();
        ctx.translate(-cameraX, 0);

        drawCloud(200, 100); drawCloud(600, 80); drawCloud(1200, 120);

        platforms.forEach(p => {
            ctx.fillStyle = p.color; ctx.fillRect(p.x, p.y, p.w, p.h);
            ctx.lineWidth = 4; ctx.strokeStyle = p.stroke; ctx.strokeRect(p.x, p.y, p.w, p.h);
            ctx.fillStyle = "#FF69B4";
            for(let i = 0; i < p.w; i += 30) ctx.fillRect(p.x + i, p.y + 5, 10, 5);
        });

        if (boss.alive) {
            if (kittyImg.complete && kittyImg.naturalHeight !== 0) {
                ctx.drawImage(kittyImg, boss.x, boss.y, boss.width, boss.height);
            } else {
                ctx.fillStyle = "#FF1493"; ctx.fillRect(boss.x, boss.y, boss.width, boss.height);
                ctx.fillStyle = "white"; ctx.font = "20px Arial"; ctx.fillText("BOSS", boss.x + 30, boss.y + 100);
            }
        }

        items.forEach(i => {
            ctx.fillStyle = "#FF4500"; ctx.fillRect(i.x, i.y, i.w, i.h);
            ctx.fillStyle = "white"; ctx.fillRect(i.x + 5, i.y + 5, 15, 2);
            ctx.fillRect(i.x + 10, i.y, 2, 15);
        });

        projectiles.forEach(p => {
            ctx.fillStyle = "#FF4500"; ctx.fillRect(p.x, p.y, p.w, p.h);
        });

        if (cocoImg.complete && cocoImg.naturalHeight !== 0) {
            ctx.drawImage(cocoImg, coco.x, coco.y, coco.width, coco.height);
        } else {
            ctx.fillStyle = "#ff69b4"; ctx.fillRect(coco.x, coco.y, coco.width, coco.height);
        }

        if (danteImg.complete && danteImg.naturalHeight !== 0) {
            if (player.direction === -1) {
                ctx.save(); ctx.scale(-1, 1);
                ctx.drawImage(danteImg, -player.x - player.width, player.y, player.width, player.height);
                ctx.restore();
            } else {
                ctx.drawImage(danteImg, player.x, player.y, player.width, player.height);
            }
        } else {
            ctx.fillStyle = "#556B2F"; ctx.fillRect(player.x, player.y, player.width, player.height);
        }
        
        if (player.carrying) {
            ctx.fillStyle = "#FF4500"; ctx.fillRect(player.x + 10, player.y - 25, 20, 20);
        }

        ctx.restore();
    }

    setTimeout(() => { update(); }, 100);
</script>
</body>
</html>
