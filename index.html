<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dante and Coco Save the Day</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; touch-action: none; font-family: 'Courier New', Courier, monospace; }
        #game-container { display: flex; justify-content: center; align-items: center; height: 100vh; }
    </style>
</head>
<body>
    <div id="game-container"></div>

<script>
/**
 * DANTE AND COCO SAVE THE DAY
 * A 5-World Storytelling Ecosystem for Future Vibrant Self (2026)
 */

const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 450,
    parent: 'game-container',
    backgroundColor: '#87CEEB',
    scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH },
    physics: { default: 'arcade', arcade: { gravity: { y: 1000 }, debug: false } },
    scene: { preload: preload, create: create, update: update }
};

const game = new Phaser.Game(config);

// Global State
let player, coco, buttons = {}, currentLvl = 1, dayTimer = 100;
let boss, henchmen, tokens = 0, hearts = 3, invincibility = false;
let timRobinson, timPlayed = false, wizard, fairy, bubble;
let isSecretRoom = false, levelComplete = false;

const lvlData = [
    { name: "Rainbow Meadow", sky: '#87CEEB', hench: "Ghost", boss: "boss1", ground: 0x228b22 },
    { name: "Sky Ranch", sky: '#DDA0DD', hench: "Horse", boss: "boss2", ground: 0x9370DB },
    { name: "Volcano Factory", sky: '#4B0082', hench: "Piranha", boss: "boss3", ground: 0x4682B4 },
    { name: "Shadow Realm", sky: '#2F4F4F', hench: "Monkey", boss: "boss4", ground: 0x000000 },
    { name: "Dream Club", sky: '#191970', hench: "Unicorn", boss: "boss5", ground: 0xFFD700 }
];

function preload() {
    // Hero Assets
    this.load.image('dante', 'Dante_32_Bit_Hero.png');
    this.load.image('coco', 'Coco_32_Bit_Hero.png');
    
    // Boss Assets
    this.load.image('boss1', 'Minion_Boss.png');
    this.load.image('boss2', 'Cowboy_Boss.png');
    this.load.image('boss3', 'Fire_Boss.png');
    this.load.image('boss4', 'Zombie_Boss.png');
    this.load.image('boss5', 'ChungLi_Boss.png');

    // NPC & Audio
    this.load.audio('timSound', 'Tim_audio.m4a');
}

function create() {
    const data = lvlData[currentLvl - 1];
    this.cameras.main.setBackgroundColor(data.sky);
    
    // The Ground
    const ground = this.add.rectangle(2000, 435, 4000, 30, data.ground);
    this.physics.add.existing(ground, true);

    // Heroes
    player = this.physics.add.sprite(100, 300, 'dante').setScale(0.8).setDepth(10);
    this.physics.add.collider(player, ground);

    // Henchmen Group
    henchmen = this.physics.add.group();
    for(let i=0; i<6; i++) {
        let h = henchmen.create(600 + (i*500), 300, 'hench').setDisplaySize(50, 50);
        h.body.setAllowGravity(false);
        h.setVelocityX(-120);
    }

    // Token Penalty Logic
    this.physics.add.overlap(player, henchmen, () => {
        if (!invincibility) {
            if (tokens > 0) tokens--;
            invincibility = true;
            player.setAlpha(0.5);
            this.time.delayedCall(1500, () => { invincibility = false; player.setAlpha(1); });
        }
    });

    // Robert Duvall Wizard
    wizard = this.physics.add.sprite(1200, 320, 'wizard').setDisplaySize(60, 90);
    wizard.body.setAllowGravity(false);
    this.physics.add.overlap(player, wizard, enterSecretRoom, null, this);

    // Tim Robinson Gatekeeper
    timRobinson = this.physics.add.sprite(1800, 320, 'tim').setDisplaySize(60, 90);
    timRobinson.body.setAllowGravity(false);
    bubble = this.add.text(1750, 240, "", { fontSize: '16px', backgroundColor: '#000', padding: 5 }).setVisible(false);

    // Boss
    boss = this.physics.add.sprite(2200, 250, data.boss).setScale(1.2);
    this.physics.add.collider(boss, ground);
    boss.hp = 5;

    // UI & iPad Controls
    this.uiText = this.add.text(20, 20, '', { fontSize: '20px', fill: '#fff', stroke: '#000', strokeThickness: 3 }).setScrollFactor(0);
    setupControls(this);

    this.cameras.main.setBounds(0, 0, 3000, 450);
    this.cameras.main.startFollow(player, true, 0.1, 0.1);
}

function enterSecretRoom(p, w) {
    if (isSecretRoom) return;
    isSecretRoom = true;
    this.cameras.main.flash(800, 0, 100, 255);
    this.cameras.main.setBackgroundColor('#000033'); // Air Aquarium Feel
    tokens += 10;
    wizard.destroy();
}

function setupControls(scene) {
    const createBtn = (x, y, txt, key) => {
        let b = scene.add.rectangle(x, y, 90, 70, 0x556B2F).setInteractive().setScrollFactor(0).setAlpha(0.7);
        scene.add.text(x, y, txt, { fontSize: '18px', fill: '#fff' }).setOrigin(0.5).setScrollFactor(0);
        b.on('pointerdown', () => { buttons[key] = true; });
        b.on('pointerup', () => { buttons[key] = false; });
    };
    createBtn(70, 380, '◀', 'left'); createBtn(180, 380, '▶', 'right');
    createBtn(600, 380, 'STRIKE', 'action'); createBtn(710, 380, 'JUMP', 'jump');
}

function update() {
    if (levelComplete) return;

    // Day/Night Atmospheric Engine
    dayTimer -= 0.012;
    if (dayTimer <= 0) { 
        alert("NIGHT HAS FALLEN! Restarting World..."); 
        this.scene.restart(); 
        dayTimer = 100;
    }

    // Movement Logic
    if (buttons.left) { player.setVelocityX(-260); player.setFlipX(true); }
    else if (buttons.right) { player.setVelocityX(260); player.setFlipX(false); }
    else player.setVelocityX(0);

    if (buttons.jump && player.body.blocked.down) player.setVelocityY(-550);

    // Tim Robinson Gatekeeper
    let distToTim = Phaser.Math.Distance.Between(player.x, player.y, timRobinson.x, timRobinson.y);
    if (distToTim < 200) {
        bubble.setVisible(true).setText("YOU SURE ABOUT THAT?").setPosition(timRobinson.x - 80, 240);
        if (!timPlayed) { this.sound.play('timSound'); timPlayed = true; }
    }

    // Combat Logic
    if (buttons.action) {
        let fx = this.add.circle(player.x + (player.flipX ? -60 : 60), player.y, 40, 0x00ffff, 0.4);
        this.time.delayedCall(100, () => fx.destroy());
        if (Phaser.Math.Distance.Between(player.x, player.y, boss.x, boss.y) < 120) {
            boss.hp -= 0.05;
            if (boss.hp <= 0) {
                levelComplete = true;
                alert(`WORLD ${currentLvl} SAVED!`);
                currentLvl = currentLvl < 5 ? currentLvl + 1 : 1;
                this.scene.restart();
                levelComplete = false;
                timPlayed = false;
                isSecretRoom = false;
                dayTimer = 100;
            }
        }
    }

    this.uiText.setText(`DAYLIGHT: ${Math.floor(dayTimer)}% | TOKENS: ${tokens}/20 | HEARTS: ❤️❤️❤️`);
}
</script>
</body>
</html>
