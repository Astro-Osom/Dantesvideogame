<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dante Saves Coco</title>
    <link rel="apple-touch-icon" href="Coco_32_Bit_Hero.jpeg">
    <style>
        body {
            background-color: #111;
            color: white;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding-top: 10px;
            touch-action: none;
        }
        canvas {
            background-color: #aeeeee; 
            border: 4px solid #fff;
            max-width: 100%;
            height: auto;
            image-rendering: pixelated; /* Keeps the 32-bit art crisp! */
        }
        .controls-container {
            display: flex;
            justify-content: space-between;
            width: 90%;
            max-width: 800px;
            margin-top: 15px;
            user-select: none;
        }
        .d-pad, .action-pad {
            display: flex;
            gap: 10px;
        }
        .t-btn {
            background-color: #556B2F; 
            border: 3px solid #fff;
            color: white;
            font-size: 24px;
            font-weight: bold;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            user-select: none;
            touch-action: manipulation;
        }
        .t-btn:active { background-color: #8FBC8F; }
    </style>
</head>
<body>

    <h2 style="margin: 5px;">DANTE SAVES COCO</h2>
    <canvas id="gameCanvas" width="800" height="400"></canvas>
    
    <div class="controls-container">
        <div class="d-pad">
            <button class="t-btn" id="btn-left">◀</button>
            <button class="t-btn" id="btn-right">▶</button>
        </div>
        <div class="action-pad">
            <button class="t-btn" id="btn-action">Pluck/Throw</button>
            <button class="t-btn" id="btn-jump">JUMP</button>
        </div>
    </div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // --- LOAD YOUR IMAGES HERE ---
    const danteImg = new Image();
    danteImg.src = "Dante_32_Bit_Hero.jpeg";

    const cocoImg = new Image();
    cocoImg.src = "Coco_32_Bit_Hero.jpeg";

    // Player (Mariner Dante)
    const player = {
        x: 50, y: 200, width: 40, height: 60, // Made him slightly bigger for the sprite
        dx: 0, dy: 0, speed: 5, jumpPower: -12,
        grounded: false, carrying: false, direction: 1
    };

    // Coco NPC
    const coco = {
        x: 650, y: 200, width: 35, height: 50
    };

    const platforms = [
        { x: 0, y: 350, w: 800, h: 50, color: "#FFB6C1" }, 
        { x: 300, y: 250, w: 150, h: 20, color: "#FFB6C1" },
        { x: 600, y: 250, w: 150, h: 20, color: "#FFB6C1" } // Platform for Coco
    ];

    const radishes = [
        { x: 400, y: 330, w: 20, h: 20, color: "#FF4500", active: true }
    ];

    let projectiles = [];
    const gravity = 0.6;
    const friction = 0.8;

    const keys = { right: false, left: false, up: false, action: false };

    const bindTouch = (id, key, isAction = false) => {
        const btn = document.getElementById(id);
        btn.addEventListener("touchstart", (e) => { e.preventDefault(); keys[key] = true; });
        btn.addEventListener("touchend", (e) => { 
            e.preventDefault(); 
            keys[key] = false; 
            if (isAction) handleAction(); 
        });
    };
    
    bindTouch("btn-left", "left");
    bindTouch("btn-right", "right");
    bindTouch("btn-jump", "up");
    bindTouch("btn-action", "action", true);

    // Keyboard bindings for testing on computer
    document.addEventListener("keydown", (e) => {
        if (e.code === "ArrowRight") keys.right = true;
        if (e.code === "ArrowLeft") keys.left = true;
        if (e.code === "Space" || e.code === "ArrowUp") keys.up = true;
        if (e.code === "KeyX" || e.code === "ArrowDown") keys.action = true;
    });
    document.addEventListener("keyup", (e) => {
        if (e.code === "ArrowRight") keys.right = false;
        if (e.code === "ArrowLeft") keys.left = false;
        if (e.code === "Space" || e.code === "ArrowUp") keys.up = false;
        if (e.code === "KeyX" || e.code === "ArrowDown") {
            keys.action = false;
            handleAction();
        }
    });

    function handleAction() {
        if (player.carrying) {
            projectiles.push({
                x: player.x, y: player.y, w: 20, h: 20,
                dx: player.direction * 10, dy: -3, color: "#FF4500"
            });
            player.carrying = false;
        } else if (player.grounded) {
            radishes.forEach(r => {
                if (r.active && Math.abs(player.x - r.x) < 30 && Math.abs(player.y + player.height - r.y) < 30) {
                    r.active = false;
                    player.carrying = true;
                }
            });
        }
    }

    function update() {
        if (keys.right) { player.dx = player.speed; player.direction = 1; }
        else if (keys.left) { player.dx = -player.speed; player.direction = -1; }
        else player.dx *= friction;

        if (keys.up && player.grounded) {
            player.dy = player.jumpPower;
            player.grounded = false;
        }

        player.dy += gravity;
        player.x += player.dx;
        player.y += player.dy;

        // Keep Dante on screen
        if (player.x < 0) player.x = 0;
        if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;

        player.grounded = false;
        platforms.forEach(p => {
            if (player.x < p.x + p.w && player.x + player.width > p.x &&
                player.y + player.height > p.y && player.y + player.height < p.y + player.dy + 2) {
                player.grounded = true;
                player.dy = 0;
                player.y = p.y - player.height;
            }
        });

        projectiles.forEach((p, index) => {
            p.dy += gravity;
            p.x += p.dx;
            p.y += p.dy;
            if (p.y > canvas.height) projectiles.splice(index, 1);
        });

        draw();
        requestAnimationFrame(update);
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw Platforms
        platforms.forEach(p => {
            ctx.fillStyle = p.color;
            ctx.fillRect(p.x, p.y, p.w, p.h);
        });

        // Draw Radishes
        radishes.forEach(r => {
            if (r.active) {
                ctx.fillStyle = r.color;
                ctx.fillRect(r.x, r.y, r.w, r.h);
                ctx.fillStyle = "#32CD32";
                ctx.fillRect(r.x + 5, r.y - 10, 10, 10);
            }
        });

        // Draw Projectiles
        projectiles.forEach(p => {
            ctx.fillStyle = p.color;
            ctx.fillRect(p.x, p.y, p.w, p.h);
        });

        // Draw Coco
        if (cocoImg.complete && cocoImg.naturalHeight !== 0) {
            ctx.drawImage(cocoImg, coco.x, coco.y, coco.width, coco.height);
        } else {
            // Backup block if image hasn't loaded yet
            ctx.fillStyle = "#ff69b4"; 
            ctx.fillRect(coco.x, coco.y, coco.width, coco.height);
        }

        // Draw Dante (With Flip Logic for facing left)
        if (danteImg.complete && danteImg.naturalHeight !== 0) {
            if (player.direction === -1) {
                ctx.save();
                ctx.scale(-1, 1); // Flip horizontally
                // We have to draw him at negative coordinates because the canvas is flipped
                ctx.drawImage(danteImg, -player.x - player.width, player.y, player.width, player.height);
                ctx.restore();
            } else {
                ctx.drawImage(danteImg, player.x, player.y, player.width, player.height);
            }
        } else {
            // Backup block if image hasn't loaded yet
            ctx.fillStyle = "#556B2F";
            ctx.fillRect(player.x, player.y, player.width, player.height);
        }
        
        // Draw Carried Item
        if (player.carrying) {
            ctx.fillStyle = "#FF4500";
            ctx.fillRect(player.x + 10, player.y - 25, 20, 20);
        }
    }

    // Give images a second to load before starting the loop
    setTimeout(() => {
        update(); 
    }, 100);
</script>
</body>
</html>
