<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dante and Coco Save the Day</title>
    <link rel="apple-touch-icon" href="Dante_App_Logo.png">
    <style>
        body { background: #000; color: #fff; font-family: 'Helvetica', sans-serif; margin: 0; overflow: hidden; touch-action: none; display: flex; flex-direction: column; align-items: center; }
        canvas { background: linear-gradient(to bottom, #87CEEB 0%, #E0F7FA 100%); border: 4px solid #fff; box-shadow: 0 0 40px #000; image-rendering: pixelated; margin-top: 5px; max-width: 95vw; height: auto; }
        .controls { display: flex; justify-content: space-between; width: 95%; max-width: 800px; margin-top: 10px; }
        .btn { background: #556B2F; border: 3px solid #fff; color: #fff; padding: 18px; border-radius: 15px; font-weight: bold; cursor: pointer; user-select: none; -webkit-tap-highlight-color: transparent; }
        .btn:active { transform: scale(0.9); background: #8FBC8F; }
        #ui { position: absolute; top: 15px; width: 800px; display: flex; justify-content: space-between; padding: 0 25px; box-sizing: border-box; pointer-events: none; }
        .stat { background: rgba(0,0,0,0.6); padding: 8px 15px; border-radius: 10px; border: 1px solid #FFB6C1; }
        #bossBar { display: none; position: absolute; top: 70px; left: 50%; transform: translateX(-50%); width: 300px; height: 20px; background: #333; border: 2px solid #fff; border-radius: 10px; overflow: hidden; }
        #bossFill { width: 100%; height: 100%; background: #ff0000; transition: width 0.3s; }
        #overlay { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.9); border: 5px solid #FF69B4; padding: 40px; text-align: center; border-radius: 25px; width: 300px; }
    </style>
</head>
<body>

    <div id="ui">
        <div class="stat" id="charUI">Dante: ❤️❤️❤️</div>
        <div class="stat" id="tokenUI">Tokens: 0/20</div>
        <div class="stat" id="lvlUI">World 1</div>
    </div>
    <div id="bossBar"><div id="bossFill"></div></div>
    <div id="overlay">
        <h1 id="msgTitle">WORLD CLEAR!</h1>
        <p id="msgText">Dante and Coco are unstoppable.</p>
        <button class="btn" onclick="nextLevel()">NEXT WORLD</button>
    </div>

    <canvas id="gameCanvas" width="800" height="400"></canvas>

    <div class="controls">
        <div style="display:flex; gap:10px;">
            <button class="btn" id="l">◀</button>
            <button class="btn" id="r">▶</button>
            <button class="btn" id="switch" style="background:#FF69B4">SWITCH</button>
        </div>
        <div style="display:flex; gap:10px;">
            <button class="btn" id="a">STRIKE</button>
            <button class="btn" id="j">JUMP</button>
        </div>
    </div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    
    // Character Assets
    const imgDante = new Image(); imgDante.src = "Dante_Hero.png";
    const imgCoco = new Image(); imgCoco.src = "Coco_Hero.png";

    // Henchmen Assets (Optional: add these .pngs to GitHub)
    const imgGhost = new Image(); imgGhost.src = "Ghost.png";
    const imgCattle = new Image(); imgCattle.src = "Cattle.png";
    const imgHorse = new Image(); imgHorse.src = "Horse.png";
    const imgPiranha = new Image(); imgPiranha.src = "Piranha.png";

    // Boss Assets
    const bossImgs = ["Minion_Boss.png", "Cowboy_Boss.png", "Fire_Boss.png", "Zombie_Boss.png", "ChungLi_Boss.png"].map(src => {
        let img = new Image(); img.src = src; return img;
    });

    let currentLvl = 1;
    let gameState = "PLAY";
    let activePlayer = "DANTE";
    let tokens = 0;
    let cameraX = 0;

    const player = { x: 100, y: 200, w: 50, h: 85, dx: 0, dy: 0, hp: 3, dir: 1, ground: false, swinging: 0 };
    const boss = { x: 1400, y: 150, w: 150, h: 200, hp: 10, maxHp: 10, active: false, alive: true };
    
    let henchmen = [];
    let worldItems = [];
    let bullets = [];

    const levels = [
        { name: "Rainbow Meadow", bg: "#87CEEB", ground: "#FFB6C1", enemy: "Ghost" },
        { name: "Sky Ranch", bg: "#DDA0DD", ground: "#9370DB", enemy: "Cattle" },
        { name: "Volcano Factory", bg: "#4B0082", ground: "#FF4500", enemy: "Piranha" },
        { name: "Shadow Realm", bg: "#2F4F4F", ground: "#000000", enemy: "Ghost" },
        { name: "The Dream Club", bg: "#191970", ground: "#FFD700", enemy: "Mixed" }
    ];

    function setupLevel(lvl) {
        const l = levels[lvl-1];
        document.getElementById('lvlUI').innerText = l.name;
        player.x = 100; player.y = 200; tokens = 0;
        boss.alive = true; boss.hp = 10; boss.active = false;
        document.getElementById('bossBar').style.display = "none";
        worldItems = []; henchmen = []; bullets = [];
        
        for(let i=0; i<20; i++) worldItems.push({ x: 300 + (i*150), y: 300, active: true });
        for(let i=0; i<5; i++) henchmen.push({ x: 500 + (i*400), y: 270, w: 40, h: 40, type: l.enemy, hp: 1 });

        gameState = "PLAY";
        document.getElementById('overlay').style.display = "none";
    }

    const keys = { l: false, r: false, j: false };
    const b = (id, k) => {
        const el = document.getElementById(id);
        el.onmousedown = el.ontouchstart = (e) => { 
            e.preventDefault(); 
            if(id === 'switch') activePlayer = (activePlayer === "DANTE") ? "COCO" : "DANTE";
            else if(id === 'a') activePlayer === "DANTE" ? player.swinging = 12 : bullets.push({ x: player.x + 20, y: player.y + 30, dx: player.dir * 12 });
            else keys[k] = true; 
        };
        el.onmouseup = el.ontouchend = (e) => { e.preventDefault(); keys[k] = false; };
    };
    b('l','l'); b('r','r'); b('j','j'); b('a','a'); b('switch','s');

    function update() {
        if(gameState !== "PLAY") return;

        if(keys.l) { player.dx = -7; player.dir = -1; }
        else if(keys.r) { player.dx = 7; player.dir = 1; }
        else player.dx *= 0.8;

        if(keys.j && player.ground) { player.dy = -15; player.ground = false; }
        player.dy += 0.7; player.x += player.dx; player.y += player.dy;
        if(player.y > 270) { player.y = 270; player.dy = 0; player.ground = true; }
        cameraX = Math.max(0, player.x - 250);

        // Boss Battle Logic
        if(player.x > 1100 && boss.alive) {
            boss.active = true;
            document.getElementById('bossBar').style.display = "block";
            if(player.x < 1100) player.x = 1100;
        }

        // Henchmen & Combat
        henchmen.forEach((h, i) => {
            if(h.type === "Piranha") h.y += Math.sin(Date.now()/200) * 2;
            if(player.swinging > 0 && Math.abs(player.x - h.x) < 80) henchmen.splice(i, 1);
            bullets.forEach((bull, bi) => {
                if(Math.abs(bull.x - h.x) < 30) { henchmen.splice(i, 1); bullets.splice(bi, 1); }
            });
            // Collision hit
            if(Math.abs(player.x - h.x) < 40 && Math.abs(player.y - h.y) < 40) {
                 // Simple reset or heart loss logic
            }
        });

        // Boss Combat
        if(boss.active && boss.alive) {
            if(player.swinging > 0 && Math.abs((player.x + (player.dir*50)) - boss.x) < 80) { boss.hp -= 0.1; player.swinging = 0; }
            bullets.forEach((bull, i) => { if(bull.x > boss.x) { boss.hp -= 1; bullets.splice(i, 1); }});
            document.getElementById('bossFill').style.width = (boss.hp / 10 * 100) + "%";
            if(boss.hp <= 0) boss.alive = false;
        }

        worldItems.forEach(t => { if(t.active && Math.abs(player.x - t.x) < 40) { t.active = false; tokens++; }});
        if(!boss.alive) { gameState = "MSG"; document.getElementById('overlay').style.display = "block"; }
        bullets.forEach((b, i) => { b.x += b.dx; if(b.x > player.x + 800) bullets.splice(i,1); });
        if(player.swinging > 0) player.swinging--;

        draw();
        requestAnimationFrame(update);
    }

    function draw() {
        ctx.clearRect(0,0,800,400);
        ctx.fillStyle = levels[currentLvl-1].bg;
        ctx.fillRect(0,0,800,400);
        ctx.save();
        ctx.translate(-cameraX, 0);

        // Environment
        ctx.fillStyle = levels[currentLvl-1].ground;
        ctx.fillRect(0, 350, 4000, 50);

        // Henchmen
        henchmen.forEach(h => {
            let hImg = h.type === "Ghost" ? imgGhost : h.type === "Cattle" ? imgCattle : imgPiranha;
            if(hImg.complete) ctx.drawImage(hImg, h.x, h.y, h.w, h.h);
            else { ctx.fillStyle = "purple"; ctx.fillRect(h.x, h.y, h.w, h.h); }
        });

        // Boss
        if(boss.alive) ctx.drawImage(bossImgs[currentLvl-1], boss.x, boss.y, boss.w, boss.h);

        // Player & Weapons
        ctx.fillStyle = "gold"; worldItems.forEach(t => { if(t.active) ctx.fillRect(t.x, t.y, 15, 15); });
        ctx.fillStyle = "yellow"; bullets.forEach(b => ctx.fillRect(b.x, b.y, 15, 5));
        
        ctx.save();
        const img = (activePlayer === "DANTE") ? imgDante : imgCoco;
        if(player.dir === -1) { ctx.translate(player.x + player.w, player.y); ctx.scale(-1, 1); ctx.drawImage(img, 0, 0, player.w, player.h); }
        else ctx.drawImage(img, player.x, player.y, player.w, player.h);
        ctx.restore();

        if(player.swinging > 0) { ctx.strokeStyle = "cyan"; ctx.lineWidth = 10; ctx.beginPath(); ctx.arc(player.x + (player.dir*40), player.y + 40, 50, -0.5, 0.5); ctx.stroke(); }
        ctx.restore();
    }

    function nextLevel() { if(currentLvl < 5) { currentLvl++; setupLevel(currentLvl); } else location.reload(); }
    setupLevel(1);
</script>
</body>
</html>
